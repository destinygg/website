(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{130:function(t,e,n){"use strict";n.r(e);var i=n(0),a=n.n(i);!function(){var t={height:500,width:420,scrollbars:0,toolbar:0,location:0,status:"no",menubar:0,resizable:0,dependent:0},e=a()("body#bigscreen"),n=e.find("#chat-panel"),i=e.find("#bigscreen-layout"),o=e.find("#chat-panel-resize-bar"),c=e.find("#chat-panel-tools"),r=e.find("#chat-wrap iframe"),s=a()('<div class="overlay"></div>'),l={getOrientation:function(){return localStorage.getItem("bigscreen.chat.orientation")||"0"},setOrientation:function(t){localStorage.setItem("bigscreen.chat.orientation",t)},getSize:function(){return parseFloat(localStorage.getItem("bigscreen.chat.size")||20)},setSize:function(t){var e="0"===this.getOrientation()?100-t:t;localStorage.setItem("bigscreen.chat.size",Math.min(76.6666,Math.max(0,e)).toFixed(4))},applyOrientation:function(){var t=l.getOrientation();switch(i.attr("data-orientation",t),parseInt(t)){case 0:i.removeClass("chat-left").addClass("chat-right");break;case 1:i.removeClass("chat-right").addClass("chat-left")}},applySize:function(){var t=l.getSize(),e=300/i.outerWidth()*100;t>e?n.css("width",Math.max(e,t)+"%"):n.css("width","inherit")}};r.on("load",(function(){var i=this.contentWindow;i&&c.on("click touch","#popout",(function(){var i;return window.open("/embed/chat","_blank",(i=i?Object.assign({},t,i):t,Object.keys(i).map((function(t){return"".concat(t,"=").concat(i[t])})).join(","))),e.addClass("nochat"),n.remove(),!1})).on("click touch","#refresh",(function(){return i.location.reload(),!1})).on("click touch","#close",(function(){return e.addClass("nochat"),n.remove(),!1})).on("click touch","#swap",(function(){return l.setOrientation("1"===l.getOrientation()?"0":"1"),l.applyOrientation(),!1}))})),o.on("mousedown.chat touchstart.chat",(function(t){var n=t.clientX||t.originalEvent.touches[0].clientX||0,a=o.position().left,c=i.outerWidth();o.addClass("active");var r=-1;return e.on("mouseup.chat touchend.chat",(function(){return-1===r||(e.unbind("mousemove.chat mouseup.chat touchend.chat touchmove.chat"),l.setSize(r/c*100),o.removeClass("active").removeAttr("style"),s.remove(),l.applySize()),!1})).on("mousemove.chat touchmove.chat",(function(t){r=t.clientX||t.originalEvent.touches[0].clientX||0,o.css("left",a+(r-n))})).append(s),!1})),l.applyOrientation(),l.applySize();var h=document.location.href,d=e.find("#stream-panel iframe"),u=/^#(twitch|twitch-vod|twitch-clip|youtube)\/([A-z0-9_\-]{3,64})$/,m={live:!1,host:null,preview:null},p={embed:!1,platform:"twitch",title:"Bigscreen",name:"destiny",id:null,url:"/bigscreen"},f=Object.assign({},p),v=["embedded","hidden","hosting","online","offline"],w={container:e.find("#nav-host-pill")},b='<i class="fab fa-fw fa-twitch"></i>';w.left=w.container.find("#nav-host-pill-type"),w.right=w.container.find("#nav-host-pill-name"),w.icon=w.container.find("#nav-host-pill-icon");var g=function(){var t="";switch(p.platform){case"twitch":t="https://player.twitch.tv/?channel="+encodeURIComponent(p.name);break;case"twitch-vod":t="https://player.twitch.tv/?video="+encodeURIComponent(p.name);break;case"twitch-clip":t="https://clips.twitch.tv/embed?clip="+encodeURIComponent(p.name);break;case"youtube":t="https://www.youtube.com/embed/"+encodeURIComponent(p.name)}if(""!==t&&d.attr("src")!==t){var e=d.clone();e.attr("src",t),d.replaceWith(e),d=e}},y=function(){w.container.removeClass(v.join(" ")),p.embed?(w.container.addClass("embedded"),w.left.text("EMBED"),w.right.text(p.title),w.icon.html('<i class="fas fa-fw fa-times-circle"></i>')):m.host&&!m.live?(w.container.addClass("hosting"),w.left.text("HOSTING"),w.right.text(m.host.name),w.icon.html(b)):(w.left.text(m.live?"LIVE":"OFFLINE"),w.right.text("Destiny"),w.icon.html(b)),w.container.toggleClass("online",m.live).toggleClass("offline",!!m.live)},C=function(){return a.a.ajax({url:"/api/info/stream"}).then((function(t){var e=t.live,n=t.host,i=t.preview;return Object.assign(m,{live:e,host:n,preview:i})})).then(y)},O=function(){var t=function(t){var e=t||window.location.hash||"";if(e.length>0&&u.test(e)){var n=e.match(u);return{platform:n[1],name:n[2],id:null}}return null}(window.location.hash);t&&(p.embed=!0,p.platform=t.platform,p.title=t.name,p.name=t.name,p.id=t.id)};O(),g(),window.history.replaceState(p,null,h),w.container.on("click touch",(function(){return!p.embed&&m.host?(p.embed=!0,p.platform="twitch",p.title=m.host.display_name,p.name=m.host.name,p.id=m.host.id,window.history.pushState(p,null,"#twitch/".concat(p.name))):p.embed&&(p.embed=!1,p.platform=f.platform,p.title=f.title,p.name=f.name,p.id=f.id,Object.assign(p,f),window.history.pushState(p,null,"/bigscreen")),y(),g(),!1})),window.addEventListener("popstate",(function(){var t=window.history.state;null==t?O():Object.assign(p,t),y(),g()})),C().always((function(){return window.setInterval(C,15e3)}))}()}},[[130,1,0]]]);