$(function(){$("#compose.message-composition").each(function(){var $modal=$("#compose"),$modalmsg=$modal.find(".modal-message"),$form=$modal.find("#compose-form"),$pagealrt=$("#alerts-container"),$message=$form.find("textarea#compose-message"),$recipients=$form.find("input#compose-recipients"),$replyto=$form.find("input#compose-replyto"),$recipientscont=$form.find(".modal-recipients .recipient-container"),$submitbtn=$form.find("button#modal-send-btn"),$clsbtn=$form.find("button#modal-close-btn"),$usergroups=$form.find(".modal-user-groups"),saveStateOnClose=!1,disableMessageForm=function(){$form.find("button,input,textarea").attr("disabled","disabled")},enableMessageForm=function(){$form.find("button,input,textarea").removeAttr("disabled")},resetForm=function(){$message.val(""),$recipients.val(""),$modalmsg.hide(),$recipientscont.empty(),enableMessageForm()},sendMessage=function(){var message=$message.val(),replyto=$replyto.val(),recipients=getRecipientLabels();return 0==recipients.length&&""==replyto?void $modalmsg.show().html('<span class="text-danger">Recipients required</span>'):""==message.trim()?void $modalmsg.show().html('<span class="text-danger">Message required</span>'):message.trim().length>500?void $modalmsg.show().html('<span class="text-danger">Your message cannot be longer than 500 characters</span>'):(saveStateOnClose=!0,disableMessageForm(),$modalmsg.show().html('<i class="fa fa-cog fa-spin"></i> Sending message ...'),void $.ajax({type:"POST",url:"/profile/messages/send",data:{recipients:recipients,message:message,replyto:replyto},success:function(data){saveStateOnClose=!1,1==data.success?($pagealrt.show().html('<div class="alert alert-info"><strong>Sent!</strong> Your message has been sent.</div>'),window.setTimeout(function(){$pagealrt.hide()},3e3),$modal.modal("hide")):($modalmsg.show().html('<span class="text-danger">'+data.message+"</span>"),enableMessageForm())},error:function(e){saveStateOnClose=!1,$modalmsg.show().html('<span class="text-danger">'+e.status+": "+e.statusText+"</span>")}}))},splitRecipientString=function(str){for(var splits=str.split(" "),names=[],i=0;i<splits.length;++i)0==splits[i].search(/^[A-Z0-9_]{3,20}$/i)&&names.push(splits[i]);return names},addRecipientLabel=function(recipient,style){var id=recipient.toLowerCase(),style=["recipient",style];$recipientscont.find('.recipient[data-recipient="'+id+'"]').get(0)||$recipientscont.append('<span class="'+style.join(" ")+'" data-recipient="'+id+'">                    <span class="recipient-name">'+recipient+'</span>                    <i class="glyphicon glyphicon-remove remove-recipient" title="Remove"></i>                  </span>')},getRecipientLabels=function(){var names=[];return $recipientscont.find(".recipient").each(function(){names.push($(this).data("recipient"))}),names};$modal.on("keydown",function(){$modalmsg.hide()}),$modal.on("shown.bs.modal",function(){$(this).find("input#compose-recipients").focus()}),$modal.on("hidden.bs.modal",function(){saveStateOnClose||resetForm()}),$modal.on("click",".remove-recipient",function(){$(this).closest(".recipient").remove()}),$modal.on("change","input#compose-recipients",function(){var recipients=splitRecipientString($(this).val());$recipients.val("");for(var i=0;i<recipients.length;++i)addRecipientLabel(recipients[i])}),$modal.on("keypress","input#compose-recipients",function(e){var keycheck=/[\;\:\,\']/i,key=e.which,KEYCODE_SPACE=32,KEYCODE_ENTER=13;if(key==KEYCODE_SPACE||key==KEYCODE_ENTER||keycheck.test(String.fromCharCode(key))){var recipients=splitRecipientString($(this).val());$recipients.val("");for(var i=0;i<recipients.length;++i)addRecipientLabel(recipients[i]);e.preventDefault(),e.stopPropagation()}$recipients.focus()}),$clsbtn.on("click",function(){$modal.modal("hide")}),$submitbtn.on("click",function(){sendMessage()}),$message.on("keydown",function(e){e.ctrlKey&&13==e.keyCode&&(sendMessage(),e.preventDefault(),e.stopPropagation())}),$usergroups.on("click",".groups a",function(){addRecipientLabel($(this).text(),"group")})})}),$(function(){var inboxtable=$("table#inbox"),readtable=$("table#read"),activateSelector=function(){$(this).find("i").attr("class","fa fa-dot-circle-o"),$(this).addClass("active")},deactivateSelector=function(){$(this).find("i").attr("class","fa fa-circle-o"),$(this).removeClass("active")},toggleRowSelector=function(e){{var self=$(this);self.closest("tr")}e.preventDefault(),e.stopPropagation(),self.hasClass("active")?deactivateSelector.apply(self):activateSelector.apply(self)},toggleRowClick=function(e){var self=$(this),messageId=self.data("id");e.preventDefault(),e.stopPropagation(),window.location.href="/profile/messages/"+messageId+"#"+messageId},pressedTableRow=function(){$(this).addClass("pressed")},releasedTableRow=function(){$(this).removeClass("pressed")};$.each([inboxtable,readtable],function(i,el){el.on("click","tbody tr",toggleRowClick),el.on("click","tbody td.selector",toggleRowSelector),el.on("mousedown","tbody tr",pressedTableRow),el.on("mouseup","tbody tr",releasedTableRow)})}),$(function(){var msgmodal=$("#compose");$(".message-list").on("click",".message-header,.message-summary",function(){$(this).closest(".message").toggleClass("message-active message-hidden")}),$(".message-reply").on("click","#reply-toggle",function(){msgmodal.unbind("shown.bs.modal").on("shown.bs.modal",function(){$(this).find("textarea").focus()}),msgmodal.find("#composeLabel").text("Reply ..."),msgmodal.find(".modal-recipients,.modal-settings,.modal-user-groups").hide(),msgmodal.find("input#compose-replyto").val($(this).data("replyto"))}),$(".message-list").each(function(){var showFullMessage=function(){$(this).closest(".message").addClass("message-active").removeClass("message-hidden")};$(this).on("click",".message-summary",showFullMessage)})});
//# sourceMappingURL=messages.min.map